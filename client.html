<html>
<head>
    <script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>
    <script src="solution.js"
        type="text/javascript"></script>
</head>
<body>
    <canvas id="canvas" width="0px" height="0px" style="background: lightgray;"></canvas>
</body>
<script language="Javascript">
    
//    var ws = new WebSocket("ws://212.71.232.20:3000/");
    var ws = new WebSocket("ws://127.0.0.1:3000/");
    
    function setName() {
        ws.send(JSON.stringify({"method":"name", "data":$("#name").val()}));
    }
    
    function print(str) {
        //console.log(str);
        $("body").prepend("<div>" + str + "</div>");
    }

    ws.onopen = function() {
        console.log("Connected");
    };

ws.onmessage = function(message) {
        console.log("Message from server: " + message.data);
        
        var response = JSON.parse(message.data);
        
        if ( response["method"] == "hello" ) {
            
            ws.send(JSON.stringify({"method":"name", "data": getName()}));
            
        } else if ( response["method"] == "startGame" ) {
            
            startGame(response["players"], response["map"]);
            drawMap(response["map"]);
            
            print("New game: " + response["players"][0] + " VS " + response["players"][1]);
            print("Map: " + response["map"]["width"] + " X " + response["map"]["height"]);
            
        } else if ( response["method"] == "endGame" ) {
            
            endGame(response["winner"]);
            
            print("Winner is " + response["winner"]);
        }
};

ws.onclose = function() {
        print("Disconnected");
};

    function drawMap(map) {
        
        var step = 40;
        
        $("#canvas").attr("width", 40 * map["width"]);
        $("#canvas").attr("height", 40 * map["height"]);        
        
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        
        function drawBoard() {
            
            for ( var i = 0; i < map["width"] + 1; ++i ) {
                context.moveTo(i * step, 0);
                context.lineTo(i * step, step * map["height"]);
            }
            
            for ( var i = 0; i < map["height"] + 1; ++i ) {
                context.moveTo(0, i * step);
                context.lineTo(step * map["width"], i * step);
            }
            
            context.strokeStyle = "black";
            context.stroke();
        }
        drawBoard();
    }
    
</script>


</html>